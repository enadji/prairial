<CONTENT VERSION="1.0" LANG="fr" CHARSET="utf-8" />

/**
 * Ouverture de la page.
 * @param {string} [titre_page] - Titre de la page à ajouter à la balise title.
 */
<DEFFUNC NAME="PAGE_START" OPTIONAL="titre_page">
	<!DOCTYPE html>
	<html lang="fr">
		<head>
			<meta charset="utf-8">
			<title><IF COND="[#TITRE_PAGE]">[#TITRE_PAGE|textebrut] – </IF>[#OPTIONS.METADONNEESSITE.TITRESITE]</title>
			<MACRO NAME="PAGE_METAS" />
			<MACRO NAME="PAGE_CSS" />
		</head>
		<LET VAR="tpl_class"/>tpl-<IF COND="[#TPL]">[#TPL]<ELSE />home</IF></LET>
		<body class="[#TPL_CLASS]">
			<MACRO NAME="PAGE_HEADER" />
			<FUNC NAME="PAGE_NAV" IDENTIFIER="menu-principal" CLASSNAME="main-nav" />
			<div class="main-container">
</DEFFUNC>

/**
 * Fermeture de la page.
 */
<DEFMACRO NAME="PAGE_END">
			</div>
			<MACRO NAME="PAGE_FOOTER" />
			<MACRO NAME="PAGE_JS" />
		</body>
	</html>
</DEFMACRO>

/**
 * Métadonnées de la page.
 */
<DEFMACRO NAME="PAGE_METAS">
	<meta name="generator" content="Lodel [#VERSION]" />
	<meta name="url" content="[%SITEINFOS.URL]" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="shortcut icon" href="./tpl/images/favicon.ico">

	<!--[ keywords / DC.subject ]-->
	<IF COND="[#OPTIONS.METADONNEESSITE.MOTSCLESDUSITE]">
		<meta name="keywords" content="[#OPTIONS.METADONNEESSITE.MOTSCLESDUSITE|textebrut|cleanBadChars|replacequotationmark]" />
		<meta name="DC.subject" content="[#OPTIONS.METADONNEESSITE.MOTSCLESDUSITE|textebrut|cleanBadChars|replacequotationmark]" />
	</IF>

	<!--[ description / DC.description ]-->
	<IF COND="[#OPTIONS.METADONNEESSITE.DESCRIPTIONSITE]">
		<LET VAR="description">[#OPTIONS.METADONNEESSITE.DESCRIPTIONSITE|textebrut|cleanBadChars|replacequotationmark]</LET>
		<meta name="description" content="[#DESCRIPTION]" />
		<meta name="DC.description" content="[#DESCRIPTION]" />
	</IF>

	<!--[ DC.rights ]-->
	<IF COND="[#OPTIONS.METADONNEESSITE.DROITSAUTEUR]">
		<meta name="DC.rights" content="[#OPTIONS.METADONNEESSITE.DROITSAUTEUR|textebrut|cleanBadChars|replacequotationmark]" />
	</IF>
	
	<!--[ Open Graph ]-->
	<meta property="og:title" content="[#OPTIONS.METADONNEESSITE.TITRESITE]" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="[%SITEINFOS.URL]" />
	<IF COND="[%CHEMIN_LOGO]">
		<meta property="og:image" content="[%CHEMIN_LOGO]" />
	</IF>
</DEFMACRO>

/**
 * Inclusion des CSS.
 */
<DEFMACRO NAME="PAGE_CSS">
	<!--[ Bootstrap ]-->
	<link href="tpl/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<!--[ Prairial ]-->
	<link href="tpl/css/prairial.css" rel="stylesheet">
	<!--[ Langage visuel Unistra ]-->
	<link href="tpl/css/sun.css" rel="stylesheet">
</DEFMACRO>

/**
 * Inclusion du JS.
 */
<DEFMACRO NAME="PAGE_JS">
	<!--[ JQuery ]-->
	<script src="tpl/vendor/jquery-3.4.1.min.js"></script>
	<!--[ Bootstrap ]-->
	<script src="tpl/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!--[ Site ]-->
	<script src="tpl/js/portail.js"></script>
	<!--[ Langage visuel Unistra ]-->
	<script src="tpl/js/sun.js"></script>
</DEFMACRO>

/**
 * Bandeau supérieur.
 */
<DEFMACRO NAME="PAGE_HEADER">
	<header class="main-header">
		<div class="container">
			<MACRO NAME="PAGE_HEADER_UNISTRA" />
		</div>
	</header>
</DEFMACRO>

<DEFMACRO NAME="PAGE_HEADER_UNISTRA">
	<div id="signature-unistra">
	<div class="sun sun-theme-primary">
		<span class="sun-row sun-offset-14">
			<span class="sun-cell sun-empty-2"></span>
			<a href="./" class="sun-cell" title="PARÉO – Pépinière de revues de l’Ouvroir" aria-hidden="true">
				<span class="sun-cell-inner">
					<strong>PARÉO</strong>
				</span>
			</a>
			<span class="sun-cell sun-empty-1 hidden-xs"></span>
			<span class="sun-cell sun-empty-1 hidden-xs"></span>
			<span class="sun-cell sun-empty-4 hidden-xs"></span>
		</span>
		<span class="sun-row">
			<span class="sun-cell sun-empty-4 hidden-sm hidden-md hidden-lg" style=""></span>
			<a href="./" class="sun-cell" title="">
				<span class="sun-cell-inner">
					<span class="hidden-xs"><strong>Pépinière</strong> de revues de l’Ouvroir</span>
				</span>
			</a>
			<span class="sun-cell sun-empty-1 hidden-sm hidden-md hidden-lg" style=""></span>
			<span class="sun-cell sun-empty-5"></span>
			<span class="sun-cell sun-empty-1"></span>
		</span>
		<span class="sun-row sun-offset-9">
			<span class="sun-cell sun-empty-2 hidden-xs"></span>
			<span class="sun-cell sun-empty-6 hidden-xs"></span>
			<a href="http://www.unistra.fr" class="sun-cell sun-hover-light" title="Université de Strasbourg">
				<span class="sun-cell-inner">Université de Strasbourg</span>
			</a>
			<span class="sun-cell sun-empty-3 hidden-xs"></span>
			<a href="https://www.misha.fr/" class="sun-cell sun-logo sun-hover-light" title="MISHA - Maison Interuniversitaire des Sciences de l'Homme - Alsace - Université de Strasbourg">
				<span class="sun-cell-inner">
					<img src="./tpl/images/sun/misha.png" alt="MISHA - Maison Interuniversitaire des Sciences de l'Homme - Alsace - Université de Strasbourg">
				</span>
			</a>
			<span class="sun-cell sun-empty-3 hidden-xs"></span>
			<a href="https://www.uha.fr/" class="sun-cell sun-logo sun-hover-light" title="Université de Haute-Alsace">
				<span class="sun-cell-inner">
					<img src="./tpl/images/sun/logo-uha.png" alt="Université de Haute-Alsace">
				</span>
			</a>
			<a href="https://www.cnrs.fr/" class="sun-cell sun-logo sun-hover-light" title="CNRS">
				<span class="sun-cell-inner">
					<img src="./tpl/images/sun/cnrs.png" alt="CNRS">
				</span>
			</a>
			<!--[ Partenaires
			<a href="http://www.msh-reseau.fr/" class="sun-cell sun-logo sun-hover-light" title="Réseau national des Maisons des Sciences de l'Homme">
				<span class="sun-cell-inner">
					<img src="./tpl/images/sun/rnmsh.png" alt="Réseau national des Maisons des Sciences de l'Homme">
				</span>
			</a>
			<a href="https://publications-prairial.fr/accueil/index.php?id=109" class="sun-cell sun-logo sun-hover-light" title="Réseau Repères">
				<span class="sun-cell-inner">
					<img src="./tpl/images/sun/reperes.png" alt="Réseau Repères">
				</span>
			</a>
			]-->
		</span>
	</div>
	</div>
</DEFMACRO>

/**
 * Pied de page.
 */
<DEFMACRO NAME="PAGE_FOOTER">
	<footer class="main-footer">
		<div class="container">
			<div class="row main-footer-contents ml-1 ml-sm-0">
				<div class="footer-col col-12 col-sm-6 col-md-4">
					<FUNC NAME="PAGE_LOGOS" IDENTIFIER="tutelles" />
				</div>
				<div class="footer-col col-12 col-sm-6 col-md-4">
					<FUNC NAME="PAGE_LOGOS" IDENTIFIER="partenaires" />
				</div>
				<div class="footer-col col-12 col-md-4">
					<h2 class="footer-section-title">[@FOOTER_LIENS]</h2>
					<ul class="footer-links">
						<FUNC NAME="PAGE_NAV" IDENTIFIER="menu-footer" CLASSNAME="footer-nav" NOWRAP="TRUE" />
						<li class="nav-item"><a class="nav-link" href="https://www.lodel.org/">[@PROPULSE_PAR_LODEL]</a></li>
						<li class="nav-item"><a class="nav-link" href="./lodel/">[@ADMINISTRATION_DU_SITE]</a></li>
						<li class="nav-item"><a class="nav-link" href="https://edinum.org">Conception : Edinum</a></li>
					</ul>
					
				</div>
			</div>
		</div>
	</footer>
</DEFMACRO>

/**
 * Insertion d'un menu.
 * @param {string} identifier - Identifiant du menu.
 * @param {string} [classname] - Classe ajoutée à l'élément nav.
 * @param {boolean} [nowrap] - Ne pas wrapper les <li> si true.
 */
<DEFFUNC NAME="PAGE_NAV" REQUIRED="identifier" OPTIONAL="classname, nowrap">
	<LET VAR="id_page_courante">[#ID]</LET>
	<LOOP NAME="page_nav_parent" TABLE="publications" WHERE="type='menu' AND identifier='[#IDENTIFIER]'" SELECT="id" LIMIT="0,1">
		<LOOP NAME="page_nav_items" TABLE="liensinternes" WHERE="type='elementdemenu' AND idparent='[#ID]'" SELECT="id, titre" ORDER="rank">
			<BEFORE>
				<IF COND="![#NOWRAP]">
					<nav class="navbar navbar-expand-lg navbar-center [#CLASSNAME]">
						<div class="container">
							<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
								<span class="navbar-toggler-icon"></span>
							</button>
							<div class="collapse navbar-collapse" id="navbarResponsive">
								<ul class="navbar-nav ml-auto-off">
				</IF>
			</BEFORE>

			<DO>
				<LET VAR="cible" /><FUNC NAME="PAGE_NAV_CIBLE" ID="[#ID]" /></LET>
				<IF COND="[#CIBLE|trim] EQ [#ID_PAGE_COURANTE] OR ([#CIBLE|trim] EQ '.' AND [#ID_PAGE_COURANTE] EQ '0')">
					<LET VAR="active_class">active</LET>
				</IF>
				<li class="nav-item [#ACTIVE_CLASS]">
					<a class="nav-link" href="[#CIBLE|trim]">[#TITRE]</a>
				</li>
			</DO>

			<AFTER>
				<IF COND="![#NOWRAP]">
								</ul>
							</div>
						</div>
					</nav>
				</IF>
			</AFTER>
		</LOOP>
	</LOOP>
</DEFFUNC>

/**
 * Récupérer la cible d'un élément de menu.
 * @param {number} id - ID de l'elementdemenu.
 * Si pas de cible alors on retourne "." pour lier vers l'accueil.
 */
<DEFFUNC NAME="PAGE_NAV_CIBLE" REQUIRED="ID">
	<LOOP NAME="page_nav_cible" TABLE="relations" WHERE="nature='cible' AND id1='[#ID]'" SELECT="id2 AS cible" LIMIT="0,1">
		<DO>[#CIBLE|makeurlwithid]</DO>
		<ALTERNATIVE>.</ALTERNATIVE>
	</LOOP>
</DEFFUNC>

/**
 * Insertion des logos partenaires.
 * @param {sting} identifier - Identifiant de la publication parente.
 */
<DEFFUNC NAME="PAGE_LOGOS" REQUIRED="identifier" OPTIONAL="classname" >
	<LOOP NAME="page_logos_parent" TABLE="publications" WHERE="type='annuairedesites' AND identifier='[#IDENTIFIER]'" SELECT="id, titre AS titreparent" LIMIT="0,1" />
		<LOOP NAME="page_logos" TABLE="liens" WHERE="type='noticedesite' AND idparent='[#ID]'" SELECT="titre, url, vignette" ORDER="rank" />
			<BEFORE>
				<div class="logos [#CLASSNAME]">
					<IF COND="[#TITREPARENT]">
						<h2 class="footer-section-title">[#TITREPARENT]</h2>
							<div class="row h-100">
					</IF>
			</BEFORE>

			<DO>
				<div class="col-md-6 my-auto">
					<IF COND="[#URL]">
						<a href="[#URL]"><img class="logos-img" src="[#VIGNETTE]" alt="[#TITRE]" /></a>
					<ELSE />
						<img class="logos-img" src="[#VIGNETTE]" alt="[#TITRE]" />
					</IF>
				</div>
			</DO>

			<AFTER>
					</div>
				</div>
			</AFTER>
		</LOOP>
	</LOOP>
</DEFFUNC>
